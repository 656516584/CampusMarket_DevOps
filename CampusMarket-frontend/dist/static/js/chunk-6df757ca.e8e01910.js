(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6df757ca"],{a0162:function(e,t,s){},b2a3:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-container"},[s("div",{staticClass:"receiver-info"},[s("el-avatar",{attrs:{size:50,src:e.receiver.avatar}}),s("div",{staticClass:"receiver-details"},[s("h3",[e._v(e._s(e.receiver.name))]),s("p",[e._v("用户ID: "+e._s(e.receiver.id))])]),s("el-button",{attrs:{type:"primary",plain:""},on:{click:e.backToProduct}},[e._v("返回商品")])],1),s("div",{ref:"messageArea",staticClass:"message-area"},e._l(e.chatters,(function(t,a){return s("div",{key:a,class:["message-bubble","me"===t.sender?"sent":"received"]},[s("div",{staticClass:"message-content"},[s("p",[e._v(e._s(t.content))]),s("span",{staticClass:"message-time"},[e._v(e._s(e.formatTime(t.createTime)))])])])})),0),s("div",{staticClass:"input-area"},[s("el-input",{attrs:{type:"textarea",rows:3,placeholder:"输入消息...",resize:"none"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)}},model:{value:e.inputMessage,callback:function(t){e.inputMessage=t},expression:"inputMessage"}}),s("div",{staticClass:"action-buttons"},[s("el-button",{attrs:{type:"primary"},on:{click:e.sendMessage}},[e._v("发送")]),s("el-button",{on:{click:e.clearInput}},[e._v("清空")])],1)],1)])},r=[],i={name:"ReceiverChat",data(){return{receiver:{id:"",name:"接收者名称",avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",productCount:0},inputMessage:"",chatters:[],loading:!1,chatInterval:null}},created(){this.fetchReceiverInfo(),this.loadChatHistory(),this.startChatPolling()},destroyed(){this.chatInterval&&clearInterval(this.chatInterval)},mounted(){this.scrollToBottom()},methods:{async fetchReceiverInfo(){const e=this.$route.query.ReceiverId||"";if(!e)return this.$message.error("缺少接收者信息"),void this.$router.back();try{const t=await this.$axios.get("/chat/getById/"+e),s=t.data.data;this.receiver={id:e,name:s.userName||"接收者"+e.slice(0,4),avatar:s.userAvatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}catch(t){console.error("获取接收者信息失败:",t),this.$message.error("获取接收者信息失败"),this.receiver.id=e}},async loadChatHistory(){const e=this.$route.query.ReceiverId||"";if(e){this.loading=!0;try{const t={senderId:-1,receiverId:e},s=await this.$axios.post("/chat/queryUser",t);s.data.data&&Array.isArray(s.data.data)&&(this.chatters=s.data.data.map(t=>{const s=new Date(t.createTime.replace("年","-").replace("月","-").replace("日","").replace(" ","T")),a=t.senderId==e?"receiver":"me";return{sender:a,content:t.content,createTime:s}})),this.chatters.sort((e,t)=>e.createTime-t.createTime),0===this.chatters.length&&this.chatters.push({sender:"receiver",content:"您好，您对我的商品有什么问题吗？",createTime:new Date(Date.now()-36e5)})}catch(t){console.error("加载聊天记录失败:",t)}finally{this.loading=!1}}},startChatPolling(){this.chatInterval=setInterval(()=>{this.loadChatHistory()},500)},async sendMessage(){const e=this.$route.query.ReceiverId||"";if(this.inputMessage.trim())if(e)try{await this.$axios.post("/chat/send",{receiverId:e,content:this.inputMessage,isRead:1});const t={sender:"me",content:this.inputMessage,receiver:"receiver"};this.chatters.push(t),this.inputMessage="",this.scrollToBottom(),setTimeout(()=>{this.simulateReceiverReply()},1500)}catch(t){console.error("发送消息失败:",t),this.$message.error("发送消息失败")}else this.$message.error("无法确定接收方")},clearInput(){this.inputMessage=""},backToProduct(){this.$router.back()},formatTime(e){return null===e?null:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.messageArea;e.scrollTop=e.scrollHeight})}}},c=i,n=(s("ec64"),s("2877")),o=Object(n["a"])(c,a,r,!1,null,"5247afc9",null);t["default"]=o.exports},ec64:function(e,t,s){"use strict";s("a0162")}}]);
//# sourceMappingURL=chunk-6df757ca.e8e01910.js.map