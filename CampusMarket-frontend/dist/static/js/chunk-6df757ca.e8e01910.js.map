{"version":3,"sources":["webpack:///./src/views/user/Chat.vue?c20a","webpack:///src/views/user/Chat.vue","webpack:///./src/views/user/Chat.vue?fd33","webpack:///./src/views/user/Chat.vue","webpack:///./src/views/user/Chat.vue?5e7d"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","receiver","avatar","_v","_s","name","id","on","backToProduct","ref","_l","chatter","index","key","class","sender","content","formatTime","createTime","nativeOn","$event","type","indexOf","_k","keyCode","sendMessage","model","value","callback","$$v","inputMessage","expression","clearInput","staticRenderFns","productCount","chatters","loading","chatInterval","fetchReceiverInfo","loadChatHistory","startChatPolling","clearInterval","scrollToBottom","methods","receiverId","$route","query","ReceiverId","$message","error","$router","back","response","$axios","get","user","data","userName","slice","userAvatar","console","chatterQueryDto","senderId","post","Array","isArray","map","formattedTime","Date","replace","sort","a","b","length","push","now","setInterval","trim","isRead","newMessage","setTimeout","simulateReceiverReply","time","toLocaleTimeString","$nextTick","container","$refs","messageArea","scrollTop","scrollHeight","component"],"mappings":"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","file":"static/js/chunk-6df757ca.e8e01910.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"chat-container\"},[_c('div',{staticClass:\"receiver-info\"},[_c('el-avatar',{attrs:{\"size\":50,\"src\":_vm.receiver.avatar}}),_c('div',{staticClass:\"receiver-details\"},[_c('h3',[_vm._v(_vm._s(_vm.receiver.name))]),_c('p',[_vm._v(\"用户ID: \"+_vm._s(_vm.receiver.id))])]),_c('el-button',{attrs:{\"type\":\"primary\",\"plain\":\"\"},on:{\"click\":_vm.backToProduct}},[_vm._v(\"返回商品\")])],1),_c('div',{ref:\"messageArea\",staticClass:\"message-area\"},_vm._l((_vm.chatters),function(chatter,index){return _c('div',{key:index,class:['message-bubble', chatter.sender === 'me' ? 'sent' : 'received']},[_c('div',{staticClass:\"message-content\"},[_c('p',[_vm._v(_vm._s(chatter.content))]),_c('span',{staticClass:\"message-time\"},[_vm._v(_vm._s(_vm.formatTime(chatter.createTime)))])])])}),0),_c('div',{staticClass:\"input-area\"},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":3,\"placeholder\":\"输入消息...\",\"resize\":\"none\"},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.sendMessage($event)}},model:{value:(_vm.inputMessage),callback:function ($$v) {_vm.inputMessage=$$v},expression:\"inputMessage\"}}),_c('div',{staticClass:\"action-buttons\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.sendMessage}},[_vm._v(\"发送\")]),_c('el-button',{on:{\"click\":_vm.clearInput}},[_vm._v(\"清空\")])],1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"chat-container\">\n    <!-- 顶部接收者信息栏 -->\n    <div class=\"receiver-info\">\n      <el-avatar :size=\"50\" :src=\"receiver.avatar\" />\n      <div class=\"receiver-details\">\n        <h3>{{ receiver.name }}</h3>\n        <p>用户ID: {{ receiver.id }}</p>\n      </div>\n      <el-button type=\"primary\" plain @click=\"backToProduct\">返回商品</el-button>\n    </div>\n\n    <!-- 聊天消息区域 -->\n    <div class=\"message-area\" ref=\"messageArea\">\n      <div\n        v-for=\"(chatter, index) in chatters\"\n        :key=\"index\"\n        :class=\"['message-bubble', chatter.sender === 'me' ? 'sent' : 'received']\"\n      >\n        <div class=\"message-content\">\n          <p>{{ chatter.content }}</p>\n          <span class=\"message-time\">{{ formatTime(chatter.createTime) }}</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- 消息输入区域 -->\n    <div class=\"input-area\">\n      <el-input\n        type=\"textarea\"\n        :rows=\"3\"\n        placeholder=\"输入消息...\"\n        v-model=\"inputMessage\"\n        @keyup.enter.native=\"sendMessage\"\n        resize=\"none\"\n      />\n      <div class=\"action-buttons\">\n        <el-button type=\"primary\" @click=\"sendMessage\">发送</el-button>\n        <el-button @click=\"clearInput\">清空</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ReceiverChat',\n  data() {\n    return {\n      receiver: {\n        id: '',\n        name: '接收者名称',\n        avatar: 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n        productCount: 0\n      },\n      inputMessage: '',\n      chatters: [],  // 改为 'chatters'，代表聊天记录\n      loading: false,\n      chatInterval: null  // 用来存储定时器ID，方便清除\n    };\n  },\n  created() {\n    this.fetchReceiverInfo();\n    this.loadChatHistory();\n    // 开始定时拉取聊天记录\n    this.startChatPolling();\n  },\n  destroyed() {\n    // 清除定时器，防止内存泄漏\n    if (this.chatInterval) {\n      clearInterval(this.chatInterval);\n    }\n  },\n  mounted() {\n    this.scrollToBottom();\n  },\n  methods: {\n    // 获取接收者的信息\n    async fetchReceiverInfo() {\n      const receiverId = this.$route.query.ReceiverId||'';\n      if (!receiverId) {\n        this.$message.error('缺少接收者信息');\n        this.$router.back();\n        return;\n      }\n\n      try {\n        const response = await this.$axios.get(`/chat/getById/${receiverId}`);\n        const user = response.data.data;\n\n        this.receiver = {\n          id: receiverId,\n          name: user.userName || '接收者' + receiverId.slice(0, 4),\n          avatar: user.userAvatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n        };\n\n      }\n      catch (error) {\n        console.error('获取接收者信息失败:', error);\n        this.$message.error('获取接收者信息失败');\n        this.receiver.id = receiverId;\n      }\n    },\n\n    // 加载聊天记录\n    async loadChatHistory() {\n      const receiverId = this.$route.query.ReceiverId||'';\n      if (!receiverId) return;\n\n      this.loading = true;\n      try {\n        const chatterQueryDto = {\n          senderId: -1,  // 当前用户ID\n          receiverId: receiverId,  // 接收者ID\n        };\n        const response = await this.$axios.post('/chat/queryUser',chatterQueryDto);\n        // 将消息处理成 'chatter' 对象\n        if (response.data.data && Array.isArray(response.data.data)) {\n          this.chatters = response.data.data.map(chatter => {\n            // 格式化时间 (根据数据格式)\n            const formattedTime = new Date(chatter.createTime.replace('年', '-').replace('月', '-').replace('日', '').replace(' ', 'T'));\n            const sender = chatter.senderId == receiverId ? 'receiver' : 'me';\n            return {\n              sender: sender,  // 判断发送者\n              content: chatter.content,\n              createTime: formattedTime,  // 格式化时间\n            };\n          });\n        }\n        this.chatters.sort((a, b) => a.createTime - b.createTime);\n        if (this.chatters.length === 0) {\n          this.chatters.push({\n            sender: 'receiver',\n            content: '您好，您对我的商品有什么问题吗？',\n            createTime: new Date(Date.now() - 3600000)\n          });\n        }\n      }\n      catch (error)\n      {\n        console.error('加载聊天记录失败:', error);\n      }\n      finally\n      {\n        this.loading = false;\n      }\n    },\n\n    // 定时拉取最新的聊天记录\n    startChatPolling() {\n      this.chatInterval = setInterval(() => {\n        this.loadChatHistory();\n      }, 500);  // 每1秒钟请求一次最新的聊天记录\n    },\n\n    // 发送消息\n    async sendMessage() {\n      const receiverId = this.$route.query.ReceiverId||'';\n      if (!this.inputMessage.trim()) return;\n      if (!receiverId) {\n        this.$message.error('无法确定接收方');\n        return;\n      }\n\n\n      try {\n        // 发送聊天消息\n        await this.$axios.post('/chat/send', {\n          receiverId: receiverId,\n          content: this.inputMessage,\n          isRead:1\n        });\n        const newMessage = {\n          sender: 'me',\n          content: this.inputMessage,\n          receiver:'receiver'\n        };\n        this.chatters.push(newMessage);\n        this.inputMessage = '';  // 清空输入框\n        this.scrollToBottom();\n\n        setTimeout(() => {\n          this.simulateReceiverReply();\n        }, 1500);\n\n      } catch (error) {\n        console.error('发送消息失败:', error);\n        this.$message.error('发送消息失败');\n      }\n    },\n\n    // 清空输入框\n    clearInput() {\n      this.inputMessage = '';\n    },\n\n    // 返回商品页面\n    backToProduct() {\n      this.$router.back();\n    },\n\n    // 格式化时间\n    formatTime(time) {\n      if (time === null) {\n        return null;\n      }\n      return time.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});\n    },\n\n    // 滚动到底部\n    scrollToBottom() {\n      this.$nextTick(() => {\n        const container = this.$refs.messageArea;\n        container.scrollTop = container.scrollHeight;\n      });\n    }\n  }\n};\n</script>\n\n<style scoped lang=\"scss\">\n$blue-primary: #2c69f0;\n$blue-light: #e6f0ff;\n$blue-lighter: #f0f6ff;\n$text-primary: #1a3a8f;\n$text-muted: #6780b3;\n$sent-bg: #2c69f0;\n$received-bg: #ffffff;\n\n.chat-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  max-width: 800px;\n  margin: 20px auto;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 4px 18px rgba(44, 105, 240, 0.25);\n  background-color: $blue-lighter;\n}\n\n.receiver-info {\n  display: flex;\n  align-items: center;\n  padding: 16px 20px;\n  background-color: $blue-primary;\n  color: white;\n\n  el-avatar {\n    border: 2px solid white;\n  }\n\n  .receiver-details {\n    flex: 1;\n    margin-left: 16px;\n\n    h3 {\n      margin: 0;\n      font-size: 20px;\n      font-weight: 700;\n    }\n\n    p {\n      margin: 4px 0 0;\n      font-size: 14px;\n      opacity: 0.85;\n    }\n  }\n\n  .el-button {\n    border-color: 1e90ff;\n    color: 1e90ff;\n    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;\n\n    &:hover,\n    &:focus {\n      background-color: rgba(30, 144, 255, 0.15); /* 浅蓝色半透明 */\n      color: #1e90ff; /* 道奇蓝 */\n      border-color: #1e90ff;\n    }\n  }\n}\n\n.message-area {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  background-color: $blue-light;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.message-bubble {\n  display: flex;\n  max-width: 70%;\n  word-wrap: break-word;\n\n  &.sent {\n    align-self: flex-end;\n    justify-content: flex-end;\n\n    .message-content {\n      background-color: $sent-bg;\n      color: white;\n      border-radius: 18px 18px 4px 18px;\n      box-shadow: 0 4px 8px rgba(44, 105, 240, 0.3);\n      padding: 10px 16px;\n    }\n\n    .message-time {\n      color: rgba(255, 255, 255, 0.75);\n      text-align: right;\n      margin-top: 6px;\n      font-size: 11px;\n    }\n  }\n\n  &.received {\n    align-self: flex-start;\n\n    .message-content {\n      background-color: $received-bg;\n      color: $text-primary;\n      border: 1px solid $blue-primary;\n      border-radius: 18px 18px 18px 4px;\n      padding: 10px 16px;\n      box-shadow: 0 2px 6px rgba(44, 105, 240, 0.15);\n    }\n\n    .message-time {\n      color: $text-muted;\n      text-align: left;\n      margin-top: 6px;\n      font-size: 11px;\n    }\n  }\n}\n\n.input-area {\n  padding: 16px 20px;\n  background-color: white;\n  border-top: 1px solid $blue-light;\n\n  .el-input {\n    width: 100%;\n    font-size: 14px;\n\n    textarea {\n      border-radius: 10px;\n      border: 1px solid $blue-primary !important;\n      resize: none;\n      padding: 10px;\n      font-family: inherit;\n      font-size: 14px;\n      transition: border-color 0.3s ease;\n\n      &:focus {\n        border-color: darken($blue-primary, 10%) !important;\n        box-shadow: 0 0 6px rgba(44, 105, 240, 0.5);\n      }\n    }\n  }\n\n  .action-buttons {\n    margin-top: 10px;\n    text-align: right;\n\n    .el-button {\n      min-width: 100px; /* 你觉得合适的宽度 */\n      padding: 8px 16px;\n      margin-left: 10px;\n      box-sizing: border-box;\n    }\n  }\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=5247afc9&scoped=true&\"\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&id=5247afc9&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5247afc9\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&id=5247afc9&scoped=true&lang=scss&\""],"sourceRoot":""}