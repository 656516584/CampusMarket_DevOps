(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d3af389c"],{"0f38":function(t,e,s){},2241:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"logo"},[s("el-image",{staticStyle:{width:"30px",height:"30px"},attrs:{src:"/logo.png",fit:"fill"}}),t.flag?t._e():s("div",[s("span",{style:{color:t.bag,display:"block"}},[t._v(t._s(t.name))])])],1)},i=[],n={name:"Logo",data(){return{}},props:{name:{type:String,default:"系统"},flag:{type:Boolean,required:!1},bag:{type:String,default:"rgb(255,255,255)"}},created(){},methods:{}},o=n,r=(s("471f"),s("2877")),l=Object(r["a"])(o,a,i,!1,null,"169c8568",null);e["a"]=l.exports},"380d":function(t,e,s){},"3c19":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"menu-container"},[s("div",{staticClass:"menu-side",class:{"menu-side-narrow":t.flag}},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("Logo",{staticStyle:{padding:"0 40px",margin:"15px 0"},attrs:{name:"校园跳蚤",flag:t.flag,bag:t.colorLogo}})],1),s("div",{staticStyle:{"margin-top":"12px"}},[s("AdminMenu",{attrs:{flag:t.flag,routes:t.adminRoutes,bag:t.bagMenu},on:{select:t.handleRouteSelect}})],1)]),s("div",{staticClass:"main"},[s("div",{staticClass:"header-section"},[s("LevelHeader",{attrs:{tag:t.tag,userInfo:t.userInfo},on:{eventListener:t.eventListener,selectOperation:t.selectOperation}})],1),s("div",{staticClass:"content-section"},[s("router-view")],1)]),s("el-dialog",{attrs:{"show-close":!1,visible:t.dialogOperaion,width:"26%"},on:{"update:visible":function(e){t.dialogOperaion=e}}},[s("div",{staticStyle:{padding:"25px 0 0 20px"},attrs:{slot:"title"},slot:"title"},[s("span",{staticStyle:{"font-size":"18px","font-weight":"800"}},[t._v("个人中心")])]),s("el-row",{staticStyle:{padding:"10px 20px 20px 20px"}},[s("el-row",[s("p",{staticStyle:{"font-size":"12px",padding:"3px 0","margin-bottom":"10px"}},[s("span",{staticClass:"modelName"},[t._v("*头像")])]),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://market.charactex.com:11451/api/campus-product-sys/v1.0/file/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[t.userInfo.url?s("img",{staticStyle:{width:"80px",height:"80px"},attrs:{src:t.userInfo.url}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),s("el-row",[s("p",{staticStyle:{"font-size":"12px",padding:"3px 0"}},[s("span",{staticClass:"modelName"},[t._v("*用户名")])]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.userInfo.name,expression:"userInfo.name"}],staticClass:"input-title",attrs:{placeholder:"用户名"},domProps:{value:t.userInfo.name},on:{input:function(e){e.target.composing||t.$set(t.userInfo,"name",e.target.value)}}})]),s("el-row",[s("p",{staticStyle:{"font-size":"12px",padding:"3px 0"}},[s("span",{staticClass:"modelName"},[t._v("*用户邮箱")])]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.userInfo.email,expression:"userInfo.email"}],staticClass:"input-title",attrs:{placeholder:"用户邮箱"},domProps:{value:t.userInfo.email},on:{input:function(e){e.target.composing||t.$set(t.userInfo,"email",e.target.value)}}})])],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"customer",staticStyle:{"background-color":"rgb(241, 241, 241)",border:"none"},attrs:{size:"small"},on:{click:function(e){t.dialogOperaion=!1}}},[t._v("取 消")]),s("el-button",{staticClass:"customer",staticStyle:{"background-color":"#15559a",border:"none"},attrs:{size:"small",type:"info"},on:{click:t.updateUserInfo}},[t._v("修改")])],1)],1)],1)},i=[],n=s("b775"),o=s("a18c"),r=s("5d2d"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-menu",{staticStyle:{padding:"5px 20px","max-width":"253px"},attrs:{"collapse-transition":!1,collapse:t.flag,"default-active":t.activeIndex,"background-color":t.bag,"text-color":"#666"},on:{select:t.handleSelect}},t._l(t.routes,(function(e,a){return void 0===e.show||!1!==e.show?s("el-menu-item",{key:a,class:{"is-active":t.activeIndex===e.path},staticStyle:{width:"100%"},attrs:{index:e.path}},[s("i",{class:e.icon,staticStyle:{"font-size":"20px"}}),s("span",{staticStyle:{"font-size":"14px"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))])]):t._e()})),1)},c=[],u={name:"AdminMenu",data(){return{activeIndex:"1",isCollapse:!0,selectedMenuItem:""}},props:{routes:{type:Array,required:!0},flag:{type:Boolean,required:!0},bag:{type:String,default:"#FFFFFF"}},created(){const t=sessionStorage.getItem("activeMenuItem");null===t?this.handleSelect("/userManage"):this.handleSelect(t)},methods:{handleSelect(t){this.activeIndex=t,this.$emit("select",this.activeIndex),sessionStorage.setItem("activeMenuItem",this.activeIndex)}}},d=u,p=(s("d7da"),s("2877")),m=Object(p["a"])(d,l,c,!1,null,"7b3f1b24",null),g=m.exports,f=s("2241"),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("span",[s("span",{staticClass:"operation-span",on:{click:t.operation}},[t.showFlag?s("i",{staticClass:"el-icon-s-unfold i-folder"}):s("i",{staticClass:"el-icon-s-fold i-folder"})])]),s("span",[s("span",{staticClass:"operation-span-tag"},[t._v(" 后台 / "+t._s(""==t.tag?"元数据":t.tag)+" ")])]),s("span",{staticClass:"user-block"},[s("el-dropdown",{staticClass:"user-dropdown"},[s("span",{staticClass:"el-dropdown-link",staticStyle:{display:"flex","align-items":"center"}},[s("el-avatar",{staticStyle:{"margin-top":"0"},attrs:{size:35,src:t.userInfo.url}}),s("span",{staticClass:"userName",staticStyle:{"margin-left":"5px","font-size":"16px"}},[t._v(t._s(t.userInfo.name))]),s("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{"margin-left":"5px"}})],1),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{icon:"el-icon-s-fold"},nativeOn:{click:function(e){return t.loginOut(e)}}},[t._v("退出登录")])],1)],1)],1)])},v=[],x={name:"LevelHeader",data(){return{showFlag:"true"===sessionStorage.getItem("flag")}},props:{tag:{type:String,required:!0,default:""},userInfo:{type:Object,required:!0,default:{}},bag:{type:String,default:""}},methods:{userCenterPanel(){this.$router.push("/myself")},loginOut(){this.$emit("eventListener","loginOut")},operation(){this.showFlag=!this.showFlag,sessionStorage.setItem("flag",this.showFlag),this.$emit("selectOperation",this.showFlag)}}},w=x,y=(s("4bf6e"),Object(p["a"])(w,h,v,!1,null,"2d91e4ce",null)),b=y.exports,S={name:"Admin",components:{Logo:f["a"],LevelHeader:b,AdminMenu:g},data(){return{adminRoutes:[],activeIndex:"",userInfo:{id:null,url:"",name:"",role:null,email:""},flag:!1,tag:"仪表盘",bag:"rgb(248,248,248)",colorLogo:"#1c1c1c",bagMenu:"rgb(248,248,248)",dialogOperaion:!1}},created(){let t=o["a"].options.routes.filter(t=>"/admin"==t.path)[0];this.adminRoutes=t.children,this.tokenCheckLoad(),this.menuOperationHistory()},methods:{async updateUserInfo(){try{const t={userAvatar:this.userInfo.url,userName:this.userInfo.name,userEmail:this.userInfo.email},e=await this.$axios.put("/user/update",t),{data:s}=e;200===s.code&&(this.dialogOperaion=!1,this.tokenCheckLoad(),this.$swal.fire({title:"修改个人信息",text:s.msg,icon:"success",showConfirmButton:!1,timer:1e3}))}catch(t){this.dialogOperaion=!1,this.$swal.fire({title:"修改个人信息异常",text:t,icon:"error",showConfirmButton:!1,timer:2e3}),console.error("修改个人信息异常:"+t)}},handleAvatarSuccess(t,e){200===t.code?(this.$message.success("头像上传成功"),this.userInfo.url=t.data):this.$message.error("头像上传异常")},eventListener(t){"center"===t&&(this.dialogOperaion=!0),"loginOut"===t&&this.loginOut()},async loginOut(){const t=await this.$swalConfirm({title:"退出登录？",text:"推出后需重新登录？",icon:"warning"});t&&(this.$swal.fire({title:"退出登录成功",text:"1s 后返回登录页面",icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{Object(r["a"])(),this.$router.push("/login")},1e3))},menuOperationHistory(){this.flag="true"===sessionStorage.getItem("flag")},selectOperation(t){this.flag=t},handleRouteSelect(t){let e=this.adminRoutes.filter(e=>e.path==t);this.tag=e[0].name,this.$router.currentRoute.fullPath!=t&&this.$router.push(t)},async tokenCheckLoad(){try{const t=await n["a"].get("user/auth");if(400===t.data.code)return this.$message.error(t.data.msg),void this.$router.push("/login");const{id:e,userAvatar:s,userName:a,userRole:i,userEmail:r}=t.data.data;this.userInfo={id:e,url:s,name:a,role:i,email:r};const l=1===i?"/admin":"/user",c=o["a"].options.routes.find(t=>t.path===l);c?this.routers=c.children:console.warn("未找到与角色对应的路由："+l)}catch(t){console.error("获取用户认证信息时发生错误:",t),this.$message.error("认证信息加载失败，请重试！")}}}},I=S,C=(s("e311"),Object(p["a"])(I,a,i,!1,null,"221ff271",null));e["default"]=C.exports},"3d12":function(t,e,s){},"471f":function(t,e,s){"use strict";s("3d12")},"4bf6e":function(t,e,s){"use strict";s("5909")},5909:function(t,e,s){},d7da:function(t,e,s){"use strict";s("380d")},e311:function(t,e,s){"use strict";s("0f38")}}]);
//# sourceMappingURL=chunk-d3af389c.72430ed4.js.map